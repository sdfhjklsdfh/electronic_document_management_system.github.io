(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.SimplePopup=a()})(function(){let a=function(){return function(a){let b,c,d,e=this;return e.options=b=a,e.defaults=c={popup:"",overlay:"",openBtn:"",closeBtn:"",scrollThreshold:100,esc:!0},e.initials=d={$popup:null,$overlay:null,$closeBtn:null,$openBtn:null,$inputs:[]},e.assign(c,b),e.assign(d,e),e.iosRegExp=/iPhone|iPad|iPod/i,e.init(),e.$popup}}();return a.prototype.assign=function(a,b){for(let c in a)void 0===b[c]&&(b[c]=a[c])},a.prototype.init=function(){let a=this,b=a.options,c=["popup","overlay","closeBtn"];for(let d,e=0;e<c.length;e++)if(d="$"+c[e],!1!==a[d]&&""!==b[c[e]]){if(a[d]=document["querySelector"+(2===e?"All":"")](b[c[e]]),"popup"===c[e]&&!a[d])return;1>=e&&(a[c[e]+"Animation"]=window.getComputedStyle(a[d]).animation||b[c[e]+"Animation"],a[c[e]+"AnimationName"]=window.getComputedStyle(a[d]).animationName||b[c[e]+"AnimationName"])}a.$popup.ctx=a,a.openPopupHandler={handleEvent:a.openPopup,ctx:a},a.closePopupHandler={handleEvent:a.closePopup,ctx:a},a.$popup.open=a.openPopup,a.$popup.close=a.closePopup,a.initEvents(),a.iosFix(),a.initOpenBtns()},a.prototype.initEvents=function(){let a=this;if(a.$closeBtn)for(let b=0;b<a.$closeBtn.length;b++)a.$closeBtn[b]&&a.$closeBtn[b].addEventListener("click",a.closePopupHandler);a.initAnimationEndEvents(a,"popup"),a.initAnimationEndEvents(a,"overlay");let b=new CustomEvent("init");a.$popup.dispatchEvent(b)},a.prototype.initAnimationEndEvents=function(a,b){let c="$"+b;a[c]&&a[c].addEventListener("animationend",function(){if(event.animationName===a[b+"AnimationName"]){if(this.style.animation="",this.classList.remove("active"),"popup"===b){let b=new CustomEvent("close");a[c].dispatchEvent(b)}}else if(event.animationName!==a[b+"AnimationName"]&&"popup"===b){let b=new CustomEvent("open");a[c].dispatchEvent(b)}})},a.prototype.initOpenBtns=function(){let a=this,b=a.options.openBtn;a.$openBtn={add:function(b){a.options.openBtn+=", "+b,this.refresh()},refresh:function(){this.elements=[];let b=document.querySelectorAll(a.options.openBtn);for(let c=0;c<b.length;c++)this.elements.push(b[c]),b[c]&&b[c].addEventListener("click",a.openPopupHandler);a.$popup.openBtn=a.$openBtn}},a.$openBtn.refresh()},a.prototype.openPopup=function(){let a=this.ctx||this;if(a.$popup.caller=event&&event.currentTarget,!a.$popup.classList.contains("active")){a.$popup.classList.add("active"),a.pageY=pageYOffset,a.$overlay&&(a.$overlay.classList.add("active"),a.$overlay.addEventListener("click",a.closePopupHandler)),a.options.esc&&document.addEventListener("keyup",a.closePopupHandler),document.addEventListener("scroll",a.closePopupHandler);let b=new CustomEvent("beforeopen");a.$popup.dispatchEvent(b)}},a.prototype.closePopup=function(){if(!(event&&"keyup"===event.type&&27!==event.keyCode)){let a=this.ctx||this;if(!(event&&"scroll"===event.type&&Math.abs(pageYOffset-a.pageY)<=a.options.scrollThreshold)&&!(event&&"scroll"===event.type&&0<a.$inputs.length&&a.$inputs.some(function(a){return a===document.activeElement}))){a.$popup.classList.contains("active")&&(a.$popup.style.animation=a.popupAnimation,a.$overlay&&(a.$overlay.style.animation=a.overlayAnimation)),a.options.esc&&document.removeEventListener("keyup",a.closePopupHandler),a.$overlay&&a.$overlay.removeEventListener("click",a.closePopupHandler),document.removeEventListener("scroll",a.closePopupHandler);let b=new CustomEvent("beforeclose");a.$popup.dispatchEvent(b)}}},a.prototype.iosFix=function(){let a=this;if(a.iosRegExp.test(navigator.userAgent)){let b=a.$popup.querySelectorAll("input, textarea");for(let c=0;c<b.length;c++)a.$inputs.push(b[c])}},a});