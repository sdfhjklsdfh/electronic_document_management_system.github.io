(function(a){"function"==typeof define&&define.amd?define([],a):"object"==typeof exports?module.exports=a():window.lazyload=a()})(function(){return lazyload=function(){return function(a){var b=this;for(var c in b.options=a||{},b.defaults={elements:".lazy",srcAttr:"data-src",mediaAttr:"data-media",clearSrc:!1,clearMedia:!1},b.elements=[],b.currentPixelRatio={},b.imageObserver=null,b.resizeHandler={handleEvent:b.windowResizeEvent,ctx:b},b.defaults)void 0===b.options[c]&&(b.options[c]=b.defaults[c]);b.init()}}(),lazyload.prototype.init=function(){var a=this;a.createImgLazyObject(),a.getPxRatio(),a.createObserver(),a.startObserve(),window.addEventListener("resize",a.resizeHandler)},lazyload.prototype.createImgLazyObject=function(a){for(var b=this,c=b.options,d=a||document.querySelectorAll(c.elements),e=/\n|\t|\s{2,}/gm,f=/\(max\-width.*?\)|\(min\-width.*?\)/g,g=/\{.*?\}/g,h={imgSet:/image-set\((.*?)\)/,pxRatio:/[0-9.]+x$/,src:/.*(?=\s[0-9.]+x$)/,split:/\,\s|\,/},k=0;k<d.length;k++){var l=d[k].getAttribute(c.mediaAttr),m=d[k].getAttribute(c.srcAttr),n=void 0,o=void 0;if(d[k].lazyObject={src:b.imgSrcParse(m,h),media:{}},l){l=l.replace(e,""),n=l.match(f),o=l.match(g);var p=d[k].lazyObject.media;p.length=n.length;for(var q=0;q<p.length;q++)p[n[q]]=b.imgSrcParse(o[q].slice(1,-1),h);c.clearMedia&&d[k].removeAttribute("data-media")}if(c.clearSrc&&d[k].removeAttribute("data-src"),b.elements.push(d[k]),"function"==typeof window.CustomEvent){var j=new CustomEvent("lazyinit");d[k].dispatchEvent(j)}}},lazyload.prototype.imgSrcParse=function(a,b){this;if(-1!==a.search("image-set")){for(var c={},d=a.replace(b.imgSet,"$1"),e=d.split(b.split),f=0;f<e.length;f++){var g=e[f].match(b.pxRatio)[0],h=e[f].match(b.src)[0];c[g]=h}return c}return a},lazyload.prototype.getPxRatio=function(){for(var a,b,c=this,d=+window.devicePixelRatio.toFixed(1),e=1;10>e;e++)if(1==e){if(d<=e){a=e+"x",b=e;break}}else if(d>e-1&&d<=e){a=e+"x",b=e;break}c.currentPixelRatio.str=a,c.currentPixelRatio.num=b},lazyload.prototype.createObserver=function(){var a=this;a.imageObserver=new IntersectionObserver(function(b){b.forEach(function(b){if(b.isIntersecting){var c,d,e=b.target,f=e.lazyObject,g=f.src,h=f.media;for(var i in h)"length"!=i&&matchMedia(i).matches&&(d=i);var j=d?h[d]:c?"":g;switch(c=a.setImg(j),e.tagName.toLowerCase()){case"img":e.src=c;break;case"header":case"section":case"footer":case"main":case"div":case"span":case"button":case"form":case"article":e.style.backgroundImage=c;}if("function"==typeof window.CustomEvent){var k=new CustomEvent("lazyloaded");e.dispatchEvent(k)}a.imageObserver.unobserve(e)}})})},lazyload.prototype.startObserve=function(a){for(var b=this,c=a||b.elements,d=0;d<c.length;d++)b.imageObserver.observe(c[d])},lazyload.prototype.setImg=function(a){var b=this,c="";if("string"==typeof a)c=a;else{var d=a[b.currentPixelRatio.str];if(!d)for(var e=1;10>e;e++){var f=b.currentPixelRatio.num-e+"x",g=a[f];if(g){d=g;break}}c=d}return c},lazyload.prototype.windowResizeEvent=function(){var a=this.ctx||this,b=a.elements;a.getPxRatio();for(var c=0;c<b.length;c++)a.imageObserver.unobserve(b[c]),a.imageObserver.observe(b[c])},lazyload.prototype.destroy=function(){var a=this;window.removeEventListener("resize",a.resizeHandler),a.imageObserver.disconnect();for(var b=0;b<a.elements.length;b++)delete a.elements[b].lazyObject;a.elements=[],a.currentPixelRatio={},a.imageObserver=null},lazyload.prototype.refresh=function(){for(var a=this,b=document.querySelectorAll(a.options.elements),c=[],d=0;d<b.length;d++)b[d].lazyObject||c.push(b[d]);a.createImgLazyObject(c),a.startObserve(c),window.removeEventListener("resize",a.resizeHandler),window.addEventListener("resize",a.resizeHandler)},lazyload});